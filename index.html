<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#08090a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <title>Momentum</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.263.0/dist/umd/lucide.min.js"></script>
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.4/babel.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #08090a;
            color: #e4e4e7;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        #root { width: 100%; height: 100%; }
        * { user-select: none; -webkit-user-select: none; }
        .ambient-glow {
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.03) 0%, transparent 70%);
        }
        [data-lucide] { opacity: 0; transition: opacity 0.3s; }
        .lucide-ready [data-lucide] { opacity: 1; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        const { useState, useEffect, useMemo } = React;

        const App = () => {
            // Locate Motion libraries safely inside the render loop
            const FM = window.FramerMotion || {};
            const motion = FM.motion;
            const AnimatePresence = FM.AnimatePresence;

            const [viewDate, setViewDate] = useState(new Date());
            const [now, setNow] = useState(new Date());
            const [focusedDay, setFocusedDay] = useState(null);

            useEffect(() => {
                const timer = setInterval(() => setNow(new Date()), 1000);
                if (window.lucide) {
                    window.lucide.createIcons();
                    document.body.classList.add('lucide-ready');
                }
                return () => clearInterval(timer);
            }, []);

            const monthName = viewDate.toLocaleString('default', { month: 'long' });
            const year = viewDate.getFullYear();
            const daysInMonth = useMemo(() => 
                new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate(), 
            [viewDate]);

            const changeMonth = (offset) => {
                setFocusedDay(null);
                setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + offset, 1));
            };

            const dayProgress = (now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds()) / 84600;

            const getOrganicOffset = (index) => ({
                x: Math.sin(index * 0.5) * 1.5,
                y: Math.cos(index * 0.5) * 1.5
            });

            // Fallback for Motion if not loaded
            const MDiv = motion ? motion.div : 'div';

            // Cascade variants
            const containerVariants = {
                hidden: { opacity: 0 },
                visible: {
                    opacity: 1,
                    transition: { staggerChildren: 0.012 }
                }
            };

            const itemVariants = {
                hidden: { opacity: 0, scale: 0.8, y: 4 },
                visible: { opacity: 1, scale: 1, y: 0 }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-8 relative overflow-hidden bg-[#08090a]">
                    <div className="fixed inset-0 pointer-events-none ambient-glow">
                        <MDiv 
                            animate={motion ? { scale: [1, 1.1, 1], opacity: [0.3, 0.4, 0.3] } : {}}
                            transition={{ duration: 15, repeat: Infinity }}
                            className="absolute top-1/3 left-1/4 w-[50%] h-[50%] bg-white/5 blur-[120px] rounded-full"
                        />
                    </div>

                    <div className="w-full max-w-lg z-10 space-y-16">
                        <header className="flex flex-col items-center gap-4">
                            <div className="flex items-center gap-8">
                                <button onClick={() => changeMonth(-1)} className="p-3 text-zinc-600 active:text-white transition-all">
                                    <i data-lucide="chevron-left"></i>
                                </button>
                                <MDiv key={monthName} initial={motion ? { opacity: 0 } : {}} animate={motion ? { opacity: 1 } : {}} className="text-center">
                                    <h1 className="text-4xl font-extralight tracking-[0.2em] uppercase text-white italic">{monthName}</h1>
                                    <p className="text-[10px] tracking-[0.5em] text-zinc-600 mt-2 font-light uppercase">{year}</p>
                                </MDiv>
                                <button onClick={() => changeMonth(1)} className="p-3 text-zinc-600 active:text-white transition-all">
                                    <i data-lucide="chevron-right"></i>
                                </button>
                            </div>
                        </header>

                        <div className="relative min-h-[340px] flex items-center justify-center">
                            {AnimatePresence ? (
                                <AnimatePresence mode="wait">
                                    <MDiv 
                                        key={`${monthName}-${year}`} 
                                        variants={containerVariants}
                                        initial="hidden"
                                        animate="visible"
                                        exit="hidden"
                                        className="grid grid-cols-7 gap-x-6 gap-y-10"
                                    >
                                        {Array.from({ length: daysInMonth }).map((_, i) => (
                                            <DayItem 
                                                key={i} 
                                                day={i+1} 
                                                viewDate={viewDate} 
                                                now={now} 
                                                focusedDay={focusedDay} 
                                                setFocusedDay={setFocusedDay} 
                                                offset={getOrganicOffset(i)}
                                                variants={itemVariants}
                                                MDiv={MDiv}
                                                AnimatePresence={AnimatePresence}
                                            />
                                        ))}
                                    </MDiv>
                                </AnimatePresence>
                            ) : (
                                <div className="grid grid-cols-7 gap-x-6 gap-y-10">
                                    {Array.from({ length: daysInMonth }).map((_, i) => (
                                        <DayItem key={i} day={i+1} viewDate={viewDate} now={now} focusedDay={focusedDay} setFocusedDay={setFocusedDay} offset={getOrganicOffset(i)} MDiv={MDiv} />
                                    ))}
                                </div>
                            )}
                        </div>

                        <footer className="space-y-12 max-w-xs mx-auto text-center" onClick={() => setFocusedDay(null)}>
                            <div className="space-y-4">
                                <div className="h-[1px] w-full bg-white/5 relative">
                                    <MDiv 
                                        animate={motion ? { width: `${dayProgress * 100}%` } : { width: '50%' }} 
                                        className="absolute top-0 left-0 h-full bg-white/40 shadow-[0_0_5px_white]" 
                                    />
                                </div>
                                <div className="flex justify-between text-[8px] tracking-[0.3em] text-zinc-600 font-light uppercase">
                                   <span>Dawn</span>
                                   <span className="text-zinc-400 font-medium italic">{Math.floor(dayProgress * 100)}% Momentum</span>
                                   <span>Dusk</span>
                                </div>
                            </div>
                            <div className="text-2xl font-extralight tracking-[0.4em] text-white/20 italic">
                               {now.toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' })}
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };

        const DayItem = ({ day, viewDate, now, focusedDay, setFocusedDay, offset, variants, MDiv, AnimatePresence }) => {
            const isToday = day === now.getDate() && viewDate.getMonth() === now.getMonth() && viewDate.getFullYear() === now.getFullYear();
            const dateObj = new Date(viewDate.getFullYear(), viewDate.getMonth(), day);
            const isPast = dateObj < new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const isFocused = focusedDay === day;

            return (
                <MDiv variants={variants} className="relative flex items-center justify-center">
                    {AnimatePresence && (
                        <AnimatePresence>
                            {isFocused && (
                                <MDiv initial={{ opacity: 0, y: 5 }} animate={{ opacity: 1, y: -24 }} exit={{ opacity: 0 }} className="absolute text-[11px] font-light tracking-widest text-white italic whitespace-nowrap z-50">
                                    day {day}
                                </MDiv>
                            )}
                        </AnimatePresence>
                    )}
                    <MDiv
                        onClick={(e) => { e.stopPropagation(); setFocusedDay(isFocused ? null : day); }}
                        className={`cursor-pointer transition-all duration-700 
                            ${isToday ? 'w-3 h-3 bg-white shadow-[0_0_15px_white] rounded-full' : 'w-2 h-2 rounded-[30%]'} 
                            ${isPast ? 'bg-zinc-800' : !isToday ? 'bg-zinc-700/20 border border-white/5' : ''} 
                            ${isFocused ? 'scale-150 rotate-45 ring-2 ring-white/20' : ''}`}
                        style={{ transform: `translate(${offset.x}px, ${offset.y}px)` }}
                    />
                </MDiv>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


